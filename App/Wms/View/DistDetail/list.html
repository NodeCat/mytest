<div class="table-responsive">
<div style="height:600px;width:900px;margin-bottom:50px;display:none" id="mapContainer" ></div>
<table id="data-table" class="data-table table table-bordered table-striped table-condensed table-hover" style="">
  <thead>
    <tr class="text-center">
      <th>
        <eq name="table.checkbox" value="true">
        <label class="checkbox">
          <input type="checkbox" class="select-all" data-target="data-table"> 全选
        </label>
        </eq>
      </th>
      <volist name="columns" id="col" offset="isset($columns['id'])?1:0">
              <th id="{$key}">{$col}</th>
      </volist>
      <eq name="table.status" value="true">
          <th>状态</th>
        </eq>
      <eq name="table.toolbar_tr" value="true">
      <th class="sorter-false">操作</th> 
      </eq> 
    </tr>
  </thead>

  <tbody>
    <volist name="data" id="vo" key="row" empty="">
      <volist name="vo['detail']" id="detail" key="k">
        <tr id="r-{$vo.id}" class="list_info_all">
          <volist name="columns" id="col" offset="0" length='1'>
          <input type="hidden" value="{$vo.user_id}" class="order-user_id" />
          <input type="hidden" value="{$vo.id}" class="order-id" />
          <input type="hidden" value="{$vo.address}" class="order-adress" />
          <input type="hidden" value="{$vo.line}" class="order-line" />
          <input type="hidden" value="{$vo.line_total}" class="order-cat" />
          <input type="hidden" value="{$vo.sku_total}" class="order-qty" />
          <td rowspan="{$vo['line_total']}" index="{$k}"><label class="checkbox"><eq name="table.checkbox" value="true"><input type="checkbox" id="{$vo[$pk]}" data-id="{$pk}" /></eq>{$row}</label></td>
          {~$values[$key]=$vo[$key]}
          </volist>

          <volist name="columns" id="col" offset="0" length="5">
            <td rowspan="{$vo['line_total']}" index="{$k}">{$vo[$key]}</td>	
            {~$values[$key]=$vo[$key]}
          </volist>
          <volist name="columns" id="col" offset="5">
          <td>{$detail[$key]}</td>
          {~$values[$key]=$detail[$key]}
          </volist>
        </tr>
      </volist>
    </volist>
  </tbody>
</table>
</div>
<include file="Index:pager"/>
<style type="text/css">
  .table-operate-btn{
    word-wrap:keep-all;
    white-space: nowrap;
  }
</style>

<script src="__PUBLIC__/tablesorter/js/jquery.tablesorter.js"></script>
<script src="__PUBLIC__/tablesorter/js/jquery.tablesorter.widgets.js"></script>
<script src="__PUBLIC__/js/light-table-filter.min.js"></script>
<script src="http://webapi.amap.com/maps?v=1.3&key=67f642a47ca5d2d0b4c4a272baeda00f" type="text/javascript"></script>
<script type="text/javascript">
$(function() {
  var td =  $('.list_info_all').children('td[rowspan]');
  td.each(function(i) {
	  //alert($(this).attr('index'));
	  if ($(this).attr('index') > 1) {
		  $(this).remove();
	  }
  }) 
  
  $('#table-content tr').each(function(){
    var id = $(this).attr('id');
    if($('#table-orders #'+id).length > 0){
      $(this).find('input[type=checkbox]').prop('checked',true);
      $('#data-table #'+id).find('input[type=checkbox]').prop('disabled',true);
    };
  });
  var flg = 1;
  $(document).on('click','#mapdisplay',function(){
       if($('#data-table').children("tbody").children("tr").length==0) return;
       if(flg == 1)
          {
          display();
          $(this).html('隐藏地图');
          $('#mapContainer').css("display","block");
          flg = 0;
          
        }else{
          $(this).html('显示地图');
          $('#mapContainer').css("display","none");
          flg = 1;
          
        }
   });
   var markerArray = []; 
   function display(){
          var mapObj;
          // 地图初始化
          mapObj = new AMap.Map("mapContainer",{
          center:new AMap.LngLat(116.397428,39.90923), //地图中心点
          level:11  //地图显示的比例尺级别
          //zoomEnable:false
        });
        <volist name="data" id="attrs">

           var markerPosition = new AMap.LngLat({$attrs['map_pos']['lng']},{$attrs['map_pos']['lat']});
           var marker = new AMap.Marker({  
                position:markerPosition,
                content:'<div class="mapIcon"  style="background:url(http://hop.test3.dachuwang.com/assets/images/will.png); color:red; width:45px; height:38px;text-align: right; padding-right: 5px;">'+"{$attrs.order_id}"+'</div>',
            });
           markerArray.push(marker);
           //markerArray[{$i}-1].setMap(mapObj);
        </volist>
   }
   $('#table-content').delegate('input[type=checkbox]','change',function(){
    if($(this).hasClass('select-all')) {
      //找到tbody中的所有checkbox
      $("#table-content tbody input[type='checkbox']").each(function(){
        // var tr = $(this).parents('tr');
        // var id = $(this).parents('tr').find('.order-id').val();
        // var row = new Array();
        // row['id'] = tr.find('.order-id').val();
        // row['user_id'] = tr.find('.order-user_id').val();
        // row['adress'] = tr.find('.order-adress').val();
        // row['line'] = tr.find('.order-line').val();
        // row['cat'] = tr.find('.order-cat').val();
        // row['qty'] = tr.find('.order-qty').val();
        if($(".select-all").prop('checked')){

          //addRow(row);
        }
        else{
          //removeRow(id);  
        }
      });
    }else{
      if($(this).prop('checked') == true) {
        // var tr = $(this).parents('tr');
        // var row = new Array();
        // row['id'] = tr.find('.order-id').val();
        // row['user_id'] = tr.find('.order-user_id').val();
        // row['adress'] = tr.find('.order-adress').val();
        // row['line'] = tr.find('.order-line').val();
        // row['cat'] = tr.find('.order-cat').val();
        // row['qty'] = tr.find('.order-qty').val();
        // addRow(row);
      }
      else {
        // $(".select-all").attr('checked',false)
        var id = $(this).parents('tr').find('.order-id').val();
        alert(id);
        // removeRow(id);
      }
    }
    
    calc();
  });


  $.extend($.tablesorter.themes.bootstrap, {
    // these classes are added to the table. To see other table classes available,
    // look here: http://twitter.github.com/bootstrap/base-css.html#tables
    table      : 'table table-bordered',
    caption    : 'caption',
    header     : 'bootstrap-header', // give the header a gradient background
    footerRow  : '',
    footerCells: '',
    icons      : '', // add "icon-white" to make them white; this icon class is added to the <i> in the header
    sortNone   : 'bootstrap-icon-unsorted',
    sortAsc    : 'icon-chevron-up glyphicon glyphicon-chevron-up',     // includes classes for Bootstrap v2 & v3
    sortDesc   : 'icon-chevron-down glyphicon glyphicon-chevron-down', // includes classes for Bootstrap v2 & v3
    active     : '', // applied when column is sorted
    hover      : '', // use custom css here - bootstrap class may not override it
    filterRow  : '', // filter row class
    even       : '', // odd row zebra striping
    odd        : ''  // even row zebra striping
  });
});
</script>
<script type="text/javascript">
$(function() {
  $(".table").tablesorter({
    theme : "bootstrap",
    headers: {
          0: {sorter: false},
      },
    widthFixed: true,
    headerTemplate : '{content} {icon}', // new in v2.7. Needed to add the bootstrap icon!
    widgets : [ "uitheme",  "zebra" ],
  });
});
</script>