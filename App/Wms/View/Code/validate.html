<div class="row" id="module-content-{$type}">
<script type="text/javascript">
$(function(){
    
    $('#pk').val('{$fk}');
    $('#module').change(function(){ 
        var n=$(this).val();
        $.ajax({
            type:"POST",  
            url:'{:U("getColumn")}',
            data:{id:n},  
            success:function(json){ 
                $('#fk').find('option').remove();
                $.each(json, function(i, value) {
                    $('#fk').append($('<option>').text(value).attr('value',value));
                });
            },
            error:function(x){  
                alert("Request error");  
            } 
        });
    }); 
    $('#shorcut').change(function(){ 
        var val=$(this).val();
        var vals = val.split(';');
        if(vals.length<4)return;
        $('#addtion').val(vals[0]);
        $('#rule').val(vals[1]);
        $('#cond').val(vals[2]);
        $('#validate_time').val(vals[3]);
        $('#error_msg').val(vals[4]);
    });
    $('#module').val('{$module}');
    $('#shorcut').change();
    $('#validate_form button[type=submit]').on('click',function(){
        var modal = $('#validate_form');
        var addr,params;
        params=modal.serialize();
        addr=modal.attr('action');
 
        $.ajax({
            url:addr,
            type:'post',
            cache : false,
            dataType:'json',
            data:params,
            success: function(msg){
                alert(msg.msg); 
                if(msg.status=='1'){
                    var newRow = msg.data;
                    $(".table tr:first").after(newRow);
                    $(".table tr:eq(1)").fadeOut(0).fadeIn(1000);
                }
            }
        }); 
        return false;
    });
}); 
</script>
<form class="form form-horizontal" id="validate_form" method="POST" action="{:U('Code/validate_save')}">
    <div class="row">
        <div class="col-lg-6">
            <div class="col-lg-6">
                <div class="input-group">
                    <span class="input-group-addon">表名</span>
                    <select id="module" name="module" class="form-control">
                    <volist name="Modules" id="vo">
                        <option value ="{$vo}">{$vo}</option>
                    </volist>
                    </select>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="input-group">
                    <span class="input-group-addon">验证字段</span>
                     <select  id='fk' name="col_id" class="form-control">
                        <volist name="module_columns" id="vo">
                            <option value ="{$vo}">{$vo}</option>
                        </volist>
                    </select>
                </div>
                
            </div>
        </div>

        <div class="col-lg-6">
            <div class="col-lg-6">
                <div class="input-group">
                    <span class="input-group-addon">验证规则</span>
                    <input id='rule' name="rule" type="text" class="form-control"  placeholder="">
                </div>
            </div>
            <div class="col-lg-6">
                <div class="input-group">
                    <span class="input-group-addon">错误提示</span>
                    <input id='error_msg' name="error_msg" type="text" class="form-control"  placeholder="">
                </div>
            </div>
        </div>
    </div>
            <br>
    <div class="row">
        <div class="col-lg-6">
            <div class="col-lg-6">
                <div class="input-group">
                  <span class="input-group-addon">快捷</span>
                    <select  id='shorcut' name="shorcut" class="form-control">
<option value ="regex;require;1;3;不能为空">数据－非空－添加和更新时－必须</option>
<option value ="unique;;1;3;已存在">数据－唯一－添加和更新时－必须</option>
<option value ="equal;等于什么;1;3;取值有误">数据－等于－添加和更新时－必须</option>
<option value ="length;长度值,如1,3;0;3;长度不合法">格式－长度－添加和更新时－存在</option>
<option value ="regex;currency;0;3;货币格式错误">格式－货币－添加和更新时－存在</option>
<option value ="regex;date;0;3;日期格式错误">格式－日期－添加和更新时－存在</option>
<option value ="regex;time;0;3;时间格式错误">格式－时间－添加和更新时－存在</option>
<option value ="regex;datetime;0;3;日期时间格式错误">格式－日期时间－添加和更新时－存在</option>
<option value ="regex;email;0;3;格式错误，请输入邮箱">格式－邮箱－添加和更新时－存在</option>
<option value ="regex;zip;0;3;格式错误，请输入邮编">格式－邮编－添加和更新时－存在</option>
<option value ="regex;english;0;3;格式错误，请输入英文字符">格式－英文－添加和更新时－存在</option>
<option value ="regex;url;0;3;格式错误，请输入url">格式－&nbsp;url&nbsp;&nbsp;－添加和更新时－存在</option>
<option value ="regex;number;0;3;格式错误，请输入数字">格式－数值－添加和更新时－存在</option>
<option value ="between;取值范围，如1,100;0;3;数值范围有误">范围－数值－添加和更新时－存在</option>
<option value ="in;取值范围如a,b,c;0;3;取值范围错误">范围－字符－添加和更新时－存在</option>
<option value ="expire;日期范围如，2015-1-1,2015-12-31;0;3;日期范围有误">范围－日期－添加和更新时－存在</option>
<option value ="">范围－时间－添加和更新时－存在</option>
<option value ="function;函数名;0;3;">调用－公共函数－添加和更新时－存在</option>
<option value ="callback;方法名;0;3;">调用－模型方法－添加和更新时－存在</option>
<!--
regex   正则验证，定义的验证规则是一个正则表达式（默认）
function    函数验证，定义的验证规则是一个函数名
callback    方法验证，定义的验证规则是当前模型类的一个方法
confirm 验证表单中的两个字段是否相同，定义的验证规则是一个字段名
equal   验证是否等于某个值，该值由前面的验证规则定义
notequal    验证是否不等于某个值，该值由前面的验证规则定义（3.1.2版本新增）
in  验证是否在某个范围内，定义的验证规则可以是一个数组或者逗号分割的字符串
notin   验证是否不在某个范围内，定义的验证规则可以是一个数组或者逗号分割的字符串（3.1.2版本新增）
length  验证长度，定义的验证规则可以是一个数字（表示固定长度）或者数字范围（例如3,12 表示长度从3到12的范围）
between 验证范围，定义的验证规则表示范围，可以使用字符串或者数组，例如1,31或者array(1,31)
notbetween  验证不在某个范围，定义的验证规则表示范围，可以使用字符串或者数组（3.1.2版本新增）
expire  验证是否在有效期，定义的验证规则表示时间范围，可以到时间，例如可以使用 2012-1-15,2013-1-15 
'regex','require',0,3,'不能为空'
'unique','',0,3,'已存在'
'length','0,45',0,3,'长度不合法'
'equal','',0,3,'不等于'
'regex','currency',0,3,'货币格式错误'
'regex','email',0,3,'格式错误，请输入邮箱'
'regex','url',0,3,'格式错误，请输入url'
'regex','number',0,3,'格式错误，请输入数字'
'between','1,100',0,3,'数值范围有误'
'in','a,b,c',0,3,'取值范围错误'
'expire','2015-1-1,2015-12-31 ',0,3,'日期范围有误'
'function','函数名',0,3,''
'callback','方法名',0,3,''
-->

                    </select>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="input-group">
                  <span class="input-group-addon">验证条件</span>
                    <select  id='cond' name="cond" class="form-control">
                        <option value ="0">存在就验证</option>
                        <option value ="1">必须验证</option>
                        <option value ="2">值不为空则验证</option>
                    </select>
                </div>
                
            </div>
            
        </div>


        <div class="col-lg-6">
            <div class="col-lg-6">
                <div class="input-group">
                  <span class="input-group-addon">附加规则</span>
                    <select  id='addtion' name="addtion" class="form-control">
                        <option value ="regex">regex</option>
                        <option value ="function">function</option>
                        <option value ="unique">unique</option>
                        <option value ="length">length</option>
                        <option value ="callback">callback</option>
                        <option value ="confirm">confirm</option>
                        <option value ="equal">equal</option>
                        <option value ="notequal">notequal</option>
                        <option value ="in">in</option>
                        <option value ="notin">notin</option>
                        <option value ="between">between</option>
                        <option value ="notbetween">notbetween</option>
                        <option value ="expire">expire</option>
                        <option value ="ip_allow">ip_allow</option>
                        <option value ="ip_deny">ip_deny</option>
                        
                    </select>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="input-group">
                  <span class="input-group-addon">验证时间</span>
                    <select  id='validate_time' name="validate_time" class="form-control">
                        <option value ="0">添加和更新</option>
                        <option value ="1">添加时</option>
                        <option value ="2">更新时</option>
                    </select>
                </div>
            </div>
            
         </div>

    </div>
    <br>
    
<include file="Index:btn"/>

</form>
<div class="col-lg-12">
    <include file="Table:list" />
</div>
</div>
