{__NOLAYOUT__}
<include file="Index/header"/>
<body>
<div>
	<a href="javascript:;" id="hidden-map" class="hidden-print btn btn-danger">隐藏地图</a>
</div>
<volist name='list' id='attrs' key="kk">
<div class="container-fluid">
  <div class="printpage" ng-repeat="attrs in list">
    <div class="">
    <div class="row">
      <div class="col-xs-4">
        <p>配送线路单号:{$attrs.dist_code}</p>
        <p class="">线路（片区）:{$attrs.line_name}</p>
        <p>客户数：{$attrs.user_count} &nbsp;&nbsp;&nbsp;&nbsp; 订单数：{$attrs.orders_length} &nbsp;&nbsp;&nbsp;&nbsp; 总件数：{$attrs.sku_count} &nbsp;&nbsp;&nbsp;&nbsp; 总金额：{$attrs.price_amount|sprintf="%.2f",###}</p>
      </div>
      <div class="col-xs-4">
          <p> 配送线路单</p>
          <img src="{$attrs.barcode}" />
      </div>
      <div class="col-xs-4">
        <p>仓库：{$attrs.warehouse_name}</p>
        <p>发车时间：{$attrs.deliver_date} {$attrs.deliver_time/* == 1 ? '上午' : '下午'*/}</p>
        <p>司机提货码：{$attrs.id}</p>
      </div>
    </div>
    <div class="order_print_table">
      <p>订单明细</p>
      <table class="table table-condensed table-bordered table-striped">

        <thead>
          <tr>
            <td width="5%">订单id</td>
            <td width="7%">出库单号</td>
            <td width="8%">线路</td>
            <td width="8%">店铺名称</td>
            <td width="10%">送货地址</td>
            <td width="7%">联系电话</td>
            <td width="8%">客户备注</td>
            <td width="5%">货品号</td>
            <td width="10%">产品名称</td>
            <td width="12%">规格</td>
            <td width="5%">单价</td>
            <td width="5%">订货数量</td>
            <td width="5%">小计</td>
            <td width="5%">重量</td>
          </tr>
        </thead>
        <volist name="attrs['orders']" id="order">
          <volist name="order['detail']" id="detail" key="k">	
          	<tr class="order_list_td">
	            <td index="{$k}" rowspan="{:count($order['detail'])}">{$order.id}</td>
	            <td index="{$k}" rowspan="{:count($order['detail'])}">{$order.code}</td>
	            <td index="{$k}" rowspan="{:count($order['detail'])}">{$order.line_name}</td>
	            <td index="{$k}" rowspan="{:count($order['detail'])}">{$order.shop_name}</td>
	            <td index="{$k}" rowspan="{:count($order['detail'])}">{$order.deliver_addr}</td>
	            <td index="{$k}" rowspan="{:count($order['detail'])}">{$order.mobile}</td>
	            <td index="{$k}" rowspan="{:count($order['detail'])}">{$order.remarks}</td>
	            <td>{$detail.pro_code}</td>
	            <td>{$detail.pro_name}</td> 
	            <td>{$detail.pro_attrs}</td>         		
	            <td>{$detail.price}元/{$detail.close_unit}</td>
	            <td>{$detail.order_qty}{$detail.unit_id}</td>
	            <td>{$detail['price'] * $detail['order_qty']|sprintf="%.2f",###}</td>
	            <td></td>
            </tr>
          </volist>
        </volist>
        <tr>
          <td>汇总</td>
          <td colspan="5"></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>{$attrs.sku_count}</td>
          <td>{$attrs.price_amount|sprintf="%.2f",###}</td>
          <td></td>
        </tr>
      </table>
    </div>
    <p>货品汇总</p>
    <div class="row sth_block">
      <div class="col-xs-6">
        <table class="table table-condensed table-bordered table-striped">
          <thead>
            <tr>
              <td>货品号</td>
              <td>产品名称</td>
              <!--<td>规格</td>-->
              <td>订货数量</td>
            </tr>
          </thead>
          <tbody>
            <volist name="attrs['sku_list']" id="detail">
              <tr>
                <td>{$detail.pro_code}</td>
                <td>{$detail.pro_name}</td>
                <!--<td><small ng-repeat="spec in detail.spec" ng-show="spec.val">{$spec.name}：{$spec.val}<br></small></td>-->
                <td>{$detail.order_qty}<notempty name="detail['unit_id']">{$detail.unit_id}<else />{$detail.uom_name}</notempty></td>
              </tr>
            </volist>
            <tr>
              <td>汇总</td>
              <td colspan="1"></td>
              <td>{$attrs.sku_count}</td>
            </tr>
          </tbody>
        </table>
      </div>
      	
      	<div class="col-xs-6">
      		<p>司机领用物品登记栏</p>
      	<table class="table table-condensed table-bordered table-striped">
          <thead>
            <tr>
            <td></td>
      		<td>保温箱</td>
      		<td>蔬菜中转筐</td>
      		<td>手推车</td>
      		<td>电子称</td>
			</tr>	
      		</thead>
      		<tbody>
      			<tr>
      				<td>数量</td>
      				<td></td>
      				<td></td>
      				<td></td>
      				<td></td>
      			</tr>
      		</tbody>
      	</table>
      </div>
      <br>
      <div class="col-xs-6 sign">
        <p class="">仓库操作人员签字：</p>
        <p class="">司机操作人员签字：</p>
        <p class="">站点操作人员签字：</p>
      </div>
    </div>
  <div class="clearfix all_count hidden-print">
      <a href="javascript:;" onclick="window.print()" class="hidden-print btn btn-success">打印全部</a>
    </div>
</div>
<div style="height:600px;width:900px;margin-bottom:50px; display:none" class="mapContainer" id="mapContainer{$kk}"></div>
<div class="staticMap">
	<img src="" alt="" class="staticImg">
</div>
<div class="hidden" id="map_pos{$kk}" >{$attrs.map_pos}</div>
</div>
</div>
</volist>
<style type="text/css">
#mapContainer {
	top:0;
	left:0;
	right:0;
	bottom:0
}.ing {
	background:url("/assets/images/ing.png") !important
}
.ed {
	background:url("/assets/images/ed.png") !important
}
.mapOrderlist {
	height:700px;
	overflow-y:auto
}
.maplist [class*="col-md"] {
	padding:0
}
.maporderdt .col-offset-3 {
	margin-left:11.9%
}
.maporderdt .row {
	padding:3px 0
}
.mt5 {
	margin-top:5px
}
.m-0 {
	margin:0
}
.maporderdl dd {
	font-size:12px
}
.maporderdl .orderlistrow {
	border-top:1px solid #ddd;
	padding:5px 0
}
.modt div {
	float:left;
	padding:5px 0
}
.modt .modt-order {
	margin-left:18px;
	width:65px
}
.modt .modt-id {
	width:64px
}
.map-number {
	font-size:24px;
	font-weight:700;
	color:#999;
	text-indent:6px
}

.printpage {
	width:100%;
	margin:auto;
	font-size:12px;
	page-break-before:avoid;
	page-break-inside:avoid;
	page-break-after:always
}
.printpage .table-bordered>thead>tr>td {
	border-bottom-width:1px
}
.printpage .table-bordered {
	border-collapse:collapse
}
.orderinfo,.mapimg {
	page-break-before:avoid;
	page-break-inside:avoid;
	min-height:500px
}
@page {
	size:A4 landscape;
	page-break-before:avoid;
	page-break-inside:avoid;
	margin-bottom:10pt;
	font-size:9pt;
	-webkit-text-size-adjust:none;
	left-middle:5pt;
	right-middle:5pt
}
@page:left {
	margin-left:5pt;
	margin-right:5pt
}
@page:right {
	margin-left:5pt;
	margin-right:5pt
}
@media print {
	.sign p {
	page-break-inside:avoid
}
.sth_block {
	position:relative;
	page-break-after:always
}
.sth_block .col-xs-6 {
	float:none;
	display:inline-block
}
.sth_block .sign {
	vertical-align:bottom;
	width:300px
}
.sth_block .sign p {
	page-break-inside:avoid;
	position:relative;
	page-break-before:always;
	page-break-after:always;
	line-height:3
}
.sth_block .sign p:after {
	content:'';
	position:absolute;
	top:20px;
	width:200px;
	border-bottom:1px solid #999
}
.page_break_after {
	page-break-after:always
}
.order_print_table table tr {
	page-break-after:auto;
	page-break-inside:avoid
}
.order_print_table table tr td {
	page-break-inside:avoid
}
.word-wrap {
	word-wrap:break-word;
	word-break:break-all
}
@media print {
	.sign p {
	page-break-inside:avoid
}
</style>
<script src="http://webapi.amap.com/maps?v=1.3&key=67f642a47ca5d2d0b4c4a272baeda00f" type="text/javascript"></script>

<script>
$(function() {
	var markerPoint;
	var ImgBase;
	var Imgsrc;
	var maxNum =10;
	var td =  $('.order_list').children('td[rowspan]');
	  td.each(function(i) {
		  //alert($(this).attr('index'));
		  if ($(this).attr('index') > 1) {
			  $(this).remove();
		  }
	  });
	$('#hidden-map').click(function() {
		if ($('.staticMap').css('display') == "block") {
			$('.staticMap').css('display',"none");
			$(this).html('显示地图');
		}else if($('.staticMap').css('display')=="none"){
			console.log("GGGGGG")
			$('.staticMap').css('display', "block");
			$(this).html('隐藏地图');
		}
	});

	$(".mapContainer").each(function(i){
		var mapObj, marker, markers = [];
		var num = i + 1;
		var map_pos = $('#map_pos'+num).html();
		//console.log(map_pos);
		// 地图初始化
		mapObj = new AMap.Map("mapContainer"+num,{
		  center:new AMap.LngLat(116.397428,39.90923), //地图中心点
		  level:11  //地图显示的比例尺级别
		  //zoomEnable:false
		});
		<volist name='list' id='attrs' key="kk">
		  if (num == {$kk}) {
			 <volist name="attrs['map_pos']" id="pos">
				var marker = new AMap.Marker({	
					//复杂图标
					icon: new AMap.Icon({    
							//图标大小
							size:new AMap.Size(28,37),
							//大图地址
							image:"http://webapi.amap.com/images/custom_a_j.png", 
							imageOffset:new AMap.Pixel(-28,0)
						}),
					//在地图上添加点
					<php>if (!empty($pos['lng']) && !empty($pos['lat'])) {</php>
						position:new AMap.LngLat({$pos.lng},{$pos.lat})
					<php>}</php>
				});
				marker.setMap(mapObj);
			 </volist>
		  }
		</volist>
		<volist name='list' id='attrs' key="kk">
		  if (num == {$kk}) {
			<volist name="attrs['map_pos']" id="pos">
			    var num;
			   		num = String.fromCharCode(65+{$i}-1)
			   	markerPoint += "mid,,"+num+":"+{$pos.lng}+","+{$pos.lat}+"|";
			</volist>
		  }
		</volist>
	});	
    markerPoint = markerPoint.slice(9,-1);
	ImgBase = "http://restapi.amap.com/v3/staticmap?size=900*600&key=ee95e52bf08006f63fd29bcfbcf21df0&markers=";
	Imgsrc = ImgBase + markerPoint;
	$('.staticImg').attr("src",Imgsrc);

})


</script>
</body>
</html>
